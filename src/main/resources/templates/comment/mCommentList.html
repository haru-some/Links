<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>영화 into the 코멘트 리스트</title>
	<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=star_rate" />
    <link rel="stylesheet" href="css/star.css">
<style>
	.content-wrap{
		width: 1400px;
		margin: 0 auto;
	}
	.order-by{
		cursor: pointer;
	}
	
	.order-by>.down{
		font-size: 15px;
		color: red;
		margin-bottom: 50px;
	}
	.content{
		width: 1200px;
		margin: 0 auto;
	}
	.page-title{		
		width:800px;
		height: 200px;		
		overflow: hidden;
	}
	
	
	.movie-title{
		margin-left: 10px;
		margin-top: 10px;
		font-size: 27px;
		font-weight: 600;
		background-color: #D9D9D9;			
		float: left;
	
	}
	.movie-summary{		
		width: 130px;
		height: 195px;
		margin-right: 20px;
		
		background-color: #D9D9D9;		
		float: right;
		
	}
		
		
	.list-wrap{
		width: 1200px;
		
		margin-left: 0px;
	}
	.comment-box{
		width: 800px;
		height: 235px;
		padding-top: 10px;
		
		
		background-color: #F3EEEE;
		
		border-bottom : 3px solid #D9D9D9;
		margin-top: 20px;
		margin-bottom: 90px;
		
		background-color: #FDFD96;;
		border-bottom : 3px solid #D9D9D9;
		
		border-bottom: 300px;
		
	}
	.line1{
		width: 780px;
		height: 25px;
		margin: 0 auto;
	}
	.profile{
		width: 25px;
		height: 25px;
		border-radius: 25px;
		
		
		
		background-color: #D9D9D9;
	}
	.star-wrap{
		overflow: hidden;
	}	
	.star-wrap>span{
	    float: left;
	    font-size: 18px;
	    color: #D9D9D9;
	    cursor: pointer;
	}
	
	.partner{
		width: 750px;
		margin: 0 auto;
		padding: 0;	
		margin : 7px 7px;			
	}
	
		
	.movie-comment{
		width: 625px;
		height:145px;
		background-color: #D9D9D9;
		
		margin-left:110px;
		
	}
	.btn-opt>span{
		width: 18px;
		height: 18px;
		margin-top: 5px;
		margin-left: 15px;
		cursor: pointer;		
	}
	.dots{
		float:right;
		margin-right: 15px;
	}
	
	.btn-box{
		width:800px;
		height: 50px;
		
		border-top: 2px  solid #C4C4C4;
		background-color: #FFF9F9;	
		display: flex;
		justify-content: space-around;
		border-bottom: 3px solid #D9D9D9;
		
		
	}
	
	.choice-like{
		margin-top: 8px;		
		cursor: pointer; 
		margin-left: 90px;
	}
	.choice-comment{
		margin-top: 8px;
		margin-right: 90px;		
		cursor: pointer;
	}
	
	
	
	
	
	
	
	
	
	
	
	.inputBox{
		display: none;
		background-color: #FFF9F9;
		margin : 0 auto;
		
	}
	.re-comm{		
		width: 600px;
		height: 100px;
		border: 0px;
		background-color: #FFF9F9;
	}
	.re-comm:checked{
		border: 0px;
	}
		
	.btn-primary{
		display: flex;
		flex-direction: reverse;
	}
	
	.line2{
		margin: 0 auto;
		margin-top: 30px;
		margin-left: 50px;
		width: 700px;
		height:160px;
		background-color: #FEECEC;
	}	
	.line2>div{
		padding-left: 50px;
	}
	.line2 .movie-re-comment{	
		width: 600px;
		height:100px;
		padding-left: 50px;
		padding-bottom: 90px;
		background-color:#D9D9D9;			
	}
	
	.modal-box{
		width: 300px;
		height: 350px;
	}
	.right-icon{
		float: right;
	}
	
	.fxxx{
		cursor: pointer;
	}
	.hxxx{
		cursor: pointer;
	}
	.sxxx{
		cursor: pointer;
	}
	.dxxx{
		cursor: pointer;
	}
	
	
</style>

</head>
<body>
<th:block th:include="common/header"></th:block>
	
	
<main class="content-wrap">
	<section class="section movie-comment-list-wrap">
		<div class="order-by">
			<span>최신 순</span>
			<span class="material-icons down">keyboard_double_arrow_down</span>
			<span>좋아요 순</span>
			<span class="material-icons down">keyboard_double_arrow_down</span>
			<span>별점 순</span>
			<span class="material-icons down">keyboard_double_arrow_down</span>
		</div>
		<div class="content">
			<div class="page-title">
				<div th:text=${m.movieTitle} class="movie-title" >제목</div>
				<div class="movie-summary"><img th:src="${m.posterPath}" style="width: 100%; height:100%"></div>	
				<!-- <img th:src="${movie.posterPath}">-->				
			</div>		
								
			<div class="list-wrap">
				<div th:each= "comm: ${list}" class="comment-box" >
					<table class="line1">
						<tr>
							<th style="width:1%;"></th>
							<th class="profile" style="width:3%;"></th>
							<th style="width:2%;"></th>
							<th th:text= "${comm.memberId}" style="width:10%;"></th>
							<th style="width:67%;"></th>								
							<th class="star-wrap" style="width:17%;">
								<span class="material-symbols-outlined"> star_rate</span>
						        <span class="material-symbols-outlined"> star_rate</span>
						        <span class="material-symbols-outlined"> star_rate</span>
						        <span class="material-symbols-outlined"> star_rate</span>
						        <span class="material-symbols-outlined"> star_rate</span>
							</th>
						<tr>			
					</table>
					<div class="partner"></div>					
					
					<div th:text= "${comm.commentContent}" class="movie-comment"></div>
					
					<div class="btn-opt">
						<span class="material-icons">thumb_up</span>
						<span class="count"> 0 </span>
						<span class="material-icons ">textsms </span>
						<span class="count"> 0 </span>	
						<!-- <span class="material-icons dots" id="dots" data-bs-toggle="modal" data-bs-target="#modal"> more_vert </span> -->
						<span class="material-icons dots report-choice" id="dots" > more_vert </span>
						 <select class="choice-box">
			         		 <option class="fxxx" value="욕설">욕설  : 공격적인 언어 사용</option>
                             <option class="hxxx" value="혐오 발언">혐오 발언 : 각종 비하 및 차별 발언</option>
                           	 <option class="sxxx" value="스포일러">스포일러 : 작품의 평가가 아닌 결과만 발언</option>
                             <option class="dxxx" value="도배">도배 : 의미 없는 문자로 수십번 반복 사용</option>
                         </select>        
					</div>
					<div class="partner"></div>
					<!-- 회원 제약조건 <tr th:if="${session.member !=null && session.member.memberId == n.memberId}">-->
					<div class="re-comm">	
						<div  class="btn-box">		
							<th:block th:if="${session.member != null}">	
								<!--  <th:block th:if="${session.member.memberId == comm.memberId}">-->			
				                    <div class="choice-like">			                    	
				                    	<span class="material-icons">thumb_up</span>
				                        <span>좋아요</span>
				                        <span>0</span>
				                    </div>
				                    <div class="choice-comment" >
				                   	 	<a th:onclick="modifyComment(this,[[${comm.memberId}]],[[${comm.commentNo}]]);"><span class="material-icons windowShow">textsms </span></a>	                    	
				                        <span>댓글</span>
				                        <span>0</span>
				                    </div>
				                <!--  </th:block> -->   
	                        </th:block>
                		</div>
                		
                		<div class="partner2"></div>
                		
                	<!-- 댓글 창 -->
						<div class="inputCommentBox inputBox" th:if="${session.member != null}">				
							<div>
								<span class="material-icons">subdirectory_arrow_right</span>									
							</div>  
							
							<textarea class="re-comm" name="reCommentContent"></textarea>
							
							<div>
								<a th:onclick="windowComment(this,[[${session.member.memberId}]],[[${comm.commentNo}]],[[${comm.contentNo}]] );">
									<button type="button" class="btn-primary ">등록</button>
								</a>										
							</div>
						</div>	
						<!-- 댓글 출력 -->
						<div th:each= "lno : ${comm.listNo}" class="print-comm"> 
							 
							<div class="line2">
								<div th:text= "${lno.memberId}" style="width:15%;"></div>
														
								<div th:text= "${lno.reCommentContent}" class="movie-re-comment"></div>
								<th:block th:if="${session.member != null}">	
									<th:block th:if="${session.member.memberId == lno.memberId}">
										<div class="right-icon">								
											<span class="material-icons btn btn-primary" id="edit-content" >create </span>							
										    <span class="material-icons" th:onclick="commDelete([[${lno.commentNo}]]);">delete_forever</span>
											<span class="material-icons dots" > more_vert </span>
										</div>
									</th:block>	
								</th:block>
							</div>
						
						</div>
						
					</div>	
				</div>
			</div>
		</div>
	</section>
	
	<!-- 모달 
	
       <div class="portfolio-modal modal fade" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
           <div class="modal-dialog">
               <div class="modal-content modal-box">
                   <div class="close-modal" data-bs-dismiss="modal"><img src="/assets/img/close-icon.svg" alt="Close modal" /></div>
                   <div class="container">
                       <div class="row justify-content-center">
                           <div class="col-s-8">
                               <div class="modal-body">
                                                                    
                                   <div class="item-intro text-muted fxxx">욕설  : 공격적인 언어 사용</div>
                                   <div class="item-intro text-muted hxxx">혐오 발언 : 각종 비하 및 차별 발언</div>
                                   <div class="item-intro text-muted sxxx">스포일러 : 작품의 평가가 아닌 결과만 발언</div>
                                   <div class="item-intro text-muted dxxx">도배 : 의미 없는 문자로 수십번 반복 사용</div>
                                   
                                   <button class="btn btn-primary btn-s text-uppercase" data-bs-dismiss="modal" type="button">
                                       <i class="fas fa-times me-1"></i>
                                       Close
                                   </button>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>
       -->
	
</main>

<th:block th:include="common/header"></th:block>
	<script src="/js/sweetalert.min.js"></script>
	<script>
	/*
		$(".fxxx").on("click",function(){		
			swal({
				title : "REPORT",
				text : "욕설을 신고할까요?",
				icon : "warning",
				buttons : {
					cancel : {
						text : "취소",
						value : false,
						visible : true,
						className: "btn-secondary",
						closeModal : true
					},
					confirm : {
						text:"신고",
						value: true,
						visible : true,
						className: "btn-primary",
						closeModal : true									
					}
				}				
			});
			location.href="/comment/commReport?commentNo="+commentNo;
						
		});	
		
		$(".hxxx").on("click",function(){		
			swal({
				title : "REPORT",
				text : "혐오발언을 신고할까요?",
				icon : "warning",
				buttons : {
					cancel : {
						text : "취소",
						value : false,
						visible : true,
						className: "btn-secondary",
						closeModal : true
					},
					confirm : {
						text:"신고",
						value: true,
						visible : true,
						className: "btn-primary",
						closeModal : true									
					}
				}				
			});
			location.href="/comment/CommReport?commentNo="+commentNo;
						
		});	
		
		$(".sxxx").on("click",function(){		
			swal({
				title : "REPORT",
				text : "스포일러를 신고할까요?",
				icon : "warning",
				buttons : {
					cancel : {
						text : "취소",
						value : false,
						visible : true,
						className: "btn-secondary",
						closeModal : true
					},
					confirm : {
						text:"신고",
						value: true,
						visible : true,
						className: "btn-primary",
						closeModal : true									
					}
				}				
			});
			location.href="/comment/CommReport?commentNo="+commentNo;
						
		});	
		
		$(".dxxx").on("click",function(){		
			swal({
				title : "REPORT",
				text : "도배를 신고할까요?",
				icon : "warning",
				buttons : {
					cancel : {
						text : "취소",
						value : false,
						visible : true,
						className: "btn-secondary",
						closeModal : true
					},
					confirm : {
						text:"신고",
						value: true,
						visible : true,
						className: "btn-primary",
						closeModal : true									
					}
				}				
			});
			location.href="/comment/CommReport?commentNo="+commentNo;
						
		});	
	
		*/	
		$(".report-choice").on("click",function(){
			
			
			const select = $("<select>");
			const option = $("<option>");
			
			option.attr("value"/reComm");//<form action="/notice/updateComment"></form>
			form.attr("method","post"); 
				<select class="choice-box">
	        		<option class="fxxx" value="욕설">욕설  : 공격적인 언어 사용</option>
	                <option class="hxxx" value="혐오 발언">혐오 발언 : 각종 비하 및 차별 발언</option>
	              	<option class="sxxx" value="스포일러">스포일러 : 작품의 평가가 아닌 결과만 발언</option>
	                <option class="dxxx" value="도배">도배 : 의미 없는 문자로 수십번 반복 사용</option>
            	</select> 
			
            	
			
			
			
			
			
		});
		
		
		$(".windowShow").on("click",function(){
			
			const index = $(".windowShow").index(this); 
			
			if($(this).text() === "▼"){
				$(this).text("▲");	
			}else{
				$(this).text("▼");
			}
			
			$(".inputBox").eq(index).slideToggle();
		});
		
				
		
		function windowComment(obj,memberId,commentNo,contentNo){		
		
		
			console.log("ㅁㅁㅁㅁㅁㅁ 윈도우 코멘트 함수")
			//form태그를 생성해서 필요한 태그들을 모두 생성해서 넣은 후 submit
			//1. form태그 생성
			const form = $("<form>");
			//1-1.form태그 속성 설정
			form.attr("action","/comment/reComm");//<form action="/notice/updateComment"></form>
			form.attr("method","post"); 	//<form action="/notice/updateComment" method="post"></form>
			
			form.hide();
			
			//2. form태그 내부에 전송하고 싶은 데이터를 input, textarea, select..등등의 태그로 삽입
			const memberIdInput = $("<input>"); 
			memberIdInput.attr("type","text"); //<input type="text">
			memberIdInput.attr("name","memberId");   //<input type = "text"  name="noticeCommentNo">			
			memberIdInput.val(memberId); 
			
			const commentNoInput = $("<input>");
			commentNoInput.attr("type","text"); 
			commentNoInput.attr("name","commentNo");
			commentNoInput.val(commentNo);			
			
			const contentNoInput = $("<input>");
			contentNoInput.attr("type","text"); 
			contentNoInput.attr("name","contentNo");
			contentNoInput.val(contentNo);
			//const commentContent = $(obj).parent().prev().children().eq(2).clone();
			const commentContent = $(obj).parent().parent().prev().clone();
			
			//폼에 다 넣어주기
			form.append(memberIdInput).append(commentNoInput).append(contentNoInput).append(commentContent);
			
			//5. body 에 새성한 from태그 추가
			$("body").append(form);
			//6. form 태그 submit
			
			//form.submit();
		};
		
		
		function commDelete(commentNo){
			swal({
				title : "댓글 삭제",
				text : "댓글 삭제 할까요?",
				icon : "warning",
				buttons : {
					cancel : {
						text : "취소",
						value : false,
						visible : true,
						className: "btn-secondary",
						closeModal : true
					},
					confirm : {
						text:"삭제",
						value: true,
						visible : true,
						className: "btn-primary",
						closeModal : true									
					}
				}				
			}).then(function(isConfirm){
				console.log(isConfirm); 
				
				if(isConfirm){
					location.href="/comment/commDelete?commentNo="+commentNo;
				}
				
			});
		}
		
		
	</script>
	
	
</body>
</html>




